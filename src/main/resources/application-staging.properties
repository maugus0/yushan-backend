# Staging Environment Configuration
# This profile is used for staging deployments on Railway

# Server Configuration
server.port=${PORT:8080}
server.servlet.context-path=/

# Database Configuration (Supabase PostgreSQL)
spring.datasource.url=${STAGING_DATABASE_URL}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.username=${STAGING_DATABASE_USERNAME}
spring.datasource.password=${STAGING_DATABASE_PASSWORD}

# Additional database configuration to prevent parsing issues
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.maximum-pool-size=1
spring.datasource.hikari.minimum-idle=0
spring.datasource.hikari.idle-timeout=60000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.keepalive-time=300000

# JPA/Hibernate Configuration - Disabled (using MyBatis only)
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=false

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true

# Force baseline reset
spring.flyway.baseline-version=0
spring.flyway.baseline-description=Initial baseline

# Redis Configuration (Upstash)
spring.data.redis.url=${STAGING_REDIS_URL}
spring.data.redis.timeout=2000ms

# Session Management - Redis only
spring.session.store-type=redis
spring.session.redis.namespace=yushan:session
spring.session.redis.flush-mode=on_save
spring.session.redis.save-mode=on_set_attribute

# Disable JdbcSession completely
spring.session.jdbc.initialize-schema=never
spring.session.jdbc.enabled=false
spring.session.jdbc.cleanup-cron=disabled
spring.session.jdbc.table-name=SPRING_SESSION

# Disable Spring Session JDBC auto-configuration completely
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.session.SessionAutoConfiguration

# Force disable all JDBC session related features
spring.session.jdbc.initialize-schema=never
spring.session.jdbc.cleanup-cron=disabled
spring.session.jdbc.enabled=false

# MyBatis Configuration
mybatis.mapper-locations=classpath:/mapper/**Mapper.xml
mybatis.type-aliases-package=com.yushan.backend.entity
mybatis.config-location=classpath:config/mybatis-config.xml

# Mail Configuration (QQ Mail)
spring.mail.host=${MAIL_HOST:smtp.qq.com}
spring.mail.username=${MAIL_USERNAME:1784304095@qq.com}
spring.mail.password=${MAIL_PASSWORD:fmgjizhjdbbabiib}
spring.mail.port=${MAIL_PORT:465}
spring.mail.default-encoding=UTF-8
spring.mail.protocol=smtps
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=3000
spring.mail.properties.mail.smtp.writetimeout=5000
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true

# Cache Configuration
spring.cache.type=redis
spring.cache.redis.time-to-live=600000
spring.cache.redis.cache-null-values=false

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.health.redis.enabled=true
management.health.db.enabled=true

# Logging Configuration
logging.level.com.yushan.backend=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.level.org.springframework.mail=DEBUG
logging.level.org.springframework.boot.autoconfigure.mail=DEBUG
logging.level.jakarta.mail=DEBUG

# CORS Configuration
spring.web.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:*}
spring.web.cors.allowed-origin-patterns=${CORS_ALLOWED_ORIGIN_PATTERNS:*}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=false

# JWT Configuration
jwt.secret=${JWT_SECRET:YushanBackendJWTSecretKey2025ForSecureTokenGenerationAndValidation}
jwt.access-token.expiration=${JWT_ACCESS_TOKEN_EXPIRATION:900000}
jwt.refresh-token.expiration=${JWT_REFRESH_TOKEN_EXPIRATION:604800000}
jwt.issuer=${JWT_ISSUER:yushan-backend}
jwt.algorithm=${JWT_ALGORITHM:HS256}

# Application Specific
app.name=Yushan Backend
app.version=@project.version@
app.environment=staging
